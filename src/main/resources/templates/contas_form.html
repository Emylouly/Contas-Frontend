<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${modoEdicao} ? 'Editar Usuário' : 'Criar Usuário'"></title>
    <link rel="stylesheet" href="/css/stylesCadastro.css">
</head>
<body>
    <form id="formCriarUsuario" th:action="${modoEdicao} ? '/usuario/salvar' : '/usuario/criar'" method="post">
        <h2 th:text="${modoEdicao} ? 'Editar Usuário' : 'Criar Usuário'"></h2>
        
        <!-- Campo oculto para o ID do usuário (usado apenas em edição) -->
        <input type="hidden" id="idusuario" name="idusuario" th:value="${usuario != null} ? ${usuario.idusuario} : ''">

        <div class="form-row">
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" th:value="${usuario != null} ? ${usuario.nome} : ''" required>
            </div>
            <div class="form-group">
                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" th:value="${usuario != null} ? ${usuario.email} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="login">Login:</label>
                <input type="text" id="login" name="login" th:value="${usuario != null} ? ${usuario.login} : ''" required>
            </div>
            <div class="form-group">
                <label for="cpf">CPF:</label>
                <input type="text" id="cpf" name="cpf" th:value="${usuario != null} ? ${usuario.cpf} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" th:value="${usuario != null} ? ${usuario.senha} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="rua">Rua:</label>
                <input type="text" id="rua" name="rua" th:value="${usuario != null} ? ${usuario.rua} : ''" required>
            </div>
            <div class="form-group">
                <label for="numero">Número:</label>
                <input type="text" id="numero" name="numero" th:value="${usuario != null} ? ${usuario.numero} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro" name="bairro" th:value="${usuario != null} ? ${usuario.bairro} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" th:value="${usuario != null} ? ${usuario.cidade} : ''" required>
            </div>
            <div class="form-group">
                <label for="estado">Estado:</label>
                <input type="text" id="estado" name="estado" th:value="${usuario != null} ? ${usuario.estado} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="cep">CEP:</label>
                <input type="text" id="cep" name="cep" th:value="${usuario != null} ? ${usuario.cep} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="telefonenumero">Número do Telefone:</label>
                <input type="text" id="telefonenumero" name="telefonenumero" th:value="${usuario != null} ? ${usuario.telefonenumero} : ''" required>
            </div>
            <div class="form-group">
                <label for="tiponumero">Tipo do Telefone:</label>
                <input type="text" id="tiponumero" name="tiponumero" th:value="${usuario != null} ? ${usuario.tiponumero} : ''" required>
            </div>
        </div>

        <div class="form-row">
            <button type="submit" th:text="${modoEdicao} ? 'Salvar Alterações' : 'Criar Usuário'"></button>
        </div>

        <a href="/usuario/listall">Voltar para a lista de usuários</a>
    </form>

    <script>
         document.getElementById("formCriarUsuario").addEventListener("submit", function (e) {
            e.preventDefault();

            const usuario = {
                idusuario: document.getElementById("idusuario").value,
                nome: document.getElementById("nome").value,
                cpf: document.getElementById("cpf").value,
                email: document.getElementById("email").value,
                login: document.getElementById("login").value,
                senha: document.getElementById("senha").value,
                estado: document.getElementById("estado").value,
                cidade: document.getElementById("cidade").value,
                bairro: document.getElementById("bairro").value,
                rua: document.getElementById("rua").value,
                numero: document.getElementById("numero").value,
                cep: document.getElementById("cep").value,
                telefonenumero: document.getElementById("telefonenumero").value,
                tiponumero: document.getElementById("tiponumero").value
            };

            const url = usuario.idusuario ? "/usuario/salvar" : "/usuario/criar";
            const method = usuario.idusuario ? "PUT" : "POST"; // Usa PUT para edição e POST para criação

            fetch(url, {
                method: method,
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(usuario)
            })
            .then(response => {
                if (response.ok) {
                    alert(usuario.idusuario ? "Usuário atualizado com sucesso!" : "Usuário criado com sucesso!");
                    window.location.href = "/usuario/listall";
                } else {
                    response.json().then(data => {
                        alert("Erro: " + data);
                    });
                }
            })
            .catch(error => {
                console.error("Erro ao enviar dados:", error);
                alert("Erro ao conectar com o servidor.");
            });
        });
    </script>
</body>
</html>